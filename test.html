<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Web demo</title>

	<link rel="stylesheet" type="text/css" href="css/jquery.fullPage.css" />
	<style>		
		.section{
			text-align: center;
			background-size: cover;
			color: #808080;
		}
	
		.black {
			background-color: black;
		}
		
		.black * {
			visibility: hidden;
		}
		
		.splash {
			background-image: url("img/green.jpg");
		}
		
		#webcam {
			transform: scaleX(-1); // flip video
		}
	</style>

	<script src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/scrolloverflow.js"></script>
	<script type="text/javascript" src="js/jquery.fullPage.js"></script>
	<script type="text/javascript">
		if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
			console.log("enumerateDevices() not supported.");
		}
		
		// list out video sources
		navigator.mediaDevices.enumerateDevices()
			.then(function(devices) { 
				let deviceId = ""
				let cameras = devices.filter( (d)=> (d.kind == "videoinput"))
				console.log("Available webcams:");
				cameras.map( (device)=> console.log(device.kind + ":" + device.deviceId) )
				
				let constraints = {
				    audio: false,
				    video: {
					    deviceId: cameras[1].deviceId,
				        width: { min: 1280, ideal: 1920 },
				        height: { min: 720, ideal: 1080 },
				    }
				};
				
				navigator.mediaDevices.getUserMedia(constraints)
					.then(function(stream) {
						let videoTracks = stream.getVideoTracks();
						console.log(videoTracks);
						let video = $('#webcam').get(0);
						console.log('Using video device: ' + videoTracks[0].label);
						stream.onended = function() { console.log('Stream ended'); };
						window.stream = stream; // make variable available to console
						video.srcObject = stream;
// 						video.play();
					})
					.catch(function(err) { console.log(err.name + ": " + err.message); }); // always check for errors at the end.
			});
			
		// Prefer camera resolution nearest to 1280x720.

		$(document).ready(function() {
			$('#fullpage').fullpage({
				scrollingSpeed: 0
			});
		});
	</script>

</head>
<body>

<div id="fullpage">
	<div class="section black" id="onstage" style="background-color: black;">
		<h1>Entering the stage</h1>
	</div>
	<div class="section splash" id="splash1"></div>
	<div class="section video" id="onstage">
		<video id="webcam" data-autoplay=true></video>
	</div>	
	<div class="section black" id="offstage"><h1>Leaving the stage</h1></div>
</div>

</body>
</html>